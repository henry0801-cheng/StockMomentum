# 0211-1 OBV DIFF 策略回測系統

## 核心邏輯

基於 **OBV(成交量均衡線)** 與 **RSI(相對強度指數)** 的股票交易策略回測框架，採用 **螞蟻群落優化演算法(ACO)** 進行參數最佳化。

## 主要指標

| 指標 | 參數 | 說明 |
|------|------|------|
| RSI | 14日 | Wilder平滑法；篩選條件：RSI > 70 |
| OBV | 自計 | 成交量加權方向累積；搭配OBV增幅排序 |
| 出場均線 | EXIT_MA | 跌破時執行賣出訊號 |
| 指數濾網 | IDX_MA1, IDX_MA2 | 雙均線濾網：同時跌破兩線才禁止進場 |

## 交易邏輯

### 進場條件（再平衡日）
1. RSI > 70 的股票
2. 按 OBV 增幅排序，取前 OBV_RANK 名
3. 指數濾網通過時才執行買進

### 出場條件（每日檢查）
- 持股跌破 EXIT_MA 時立即賣出

### 資金管理
- 初始資本：2,000 萬（固定）
- 交易稅：0.1%
- 滑價：0.3%
- 單檔進場預算 = 初始資本 / S_H（最大持倉數）

## 可優化參數

| 參數 | 範圍 | 釋義 |
|------|------|------|
| S_H | 2~10 | 最大同時持倉檔數 |
| RE_DAYS | 5~60 | 再平衡間隔天數 |
| EXIT_MA | 5~60 | 出場均線天數 |
| OBV_RANK | 1~5 | 每次進場選取前幾名 |
| OBV_WINDOW | 5~10 | OBV增幅計算天窗 |
| IDX_MA1 | 10~200 | 指數濾網第一均線 |
| IDX_MA2 | 20~200 | 指數濾網第二均線 |

## 最佳化方式

### ACO 模式
- 螞蟻數量：50
- 世代數：5
- 費洛蒙蒸發率：0.5
- 自動搜尋最優參數組合

### MANUAL 模式
預設參數：
```
S_H=5, RE_DAYS=15, EXIT_MA=15, 
OBV_RANK=3, OBV_WINDOW=15, 
IDX_MA1=30, IDX_MA2=60
```

## 績效指標

- **CAGR**：年化複利報酬
- **最大回檔(MaxDD)**：最大衰退幅度
- **Calmar比**：CAGR / |MaxDD|（風險調整後報酬）

## 輸出結果

| 檔案 | 內容 |
|------|------|
| strategy_results.xlsx | 交易明細、權益曲線、持倉紀錄、進場候選 |
| equity_curve.png | 權益曲線圖（含回檔區域標示） |

## 類別結構

- **Config**：配置、常數、參數範圍定義
- **DataLoader**：讀取 Excel 個股與指數資料
- **Strategy**：指標計算、交易邏輯、回測引擎
- **AntColonyOptimizer**：ACO 最佳化框架
